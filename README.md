# Трекер Атомных Привычек

Этот проект представляет собой веб-приложение для отслеживания и формирования полезных привычек, вдохновленное книгой Джеймса Клира "Атомные привычки". Цель трекера – помочь пользователям приобретать новые полезные привычки и избавляться от вредных.

## Концепция

В основе приложения лежит модель привычки, описываемая формулой: "Я буду [ДЕЙСТВИЕ] в [ВРЕМЯ] в [МЕСТО]".

### Модель Привычки

*   **Пользователь:** Создатель привычки.
*   **Место:** Место выполнения привычки.
*   **Время:** Время выполнения привычки.
*   **Действие:** Само действие привычки.
*   **Признак приятной привычки (is\_pleasant):** Флаг, указывающий, является ли привычка приятной (например, вознаграждением).
*   **Связанная привычка:** Ссылка на приятную привычку, которая служит вознаграждением (доступно только для полезных привычек).
*   **Периодичность:** Частота выполнения привычки (в днях, по умолчанию ежедневно).
*   **Вознаграждение:** Чем пользователь может себя вознаградить после выполнения (доступно только для полезных привычек).
*   **Время на выполнение:** Максимальное время, которое должно быть потрачено на выполнение привычки (не более 120 секунд).
*   **Признак публичности:** Флаг, определяющий доступность привычки другим пользователям.

### Типы привычек:

*   **Полезная привычка:** Основное действие, которое может сопровождаться вознаграждением или связанной приятной привычкой.
*   **Приятная привычка:** Способ вознаграждения, который не может иметь собственного вознаграждения или связанной привычки.

### Валидация:

1.  Нельзя одновременно указывать **вознаграждение** и **связанную привычку** для одной привычки.
2.  **Время на выполнение** должно быть ≤ 120 секунд.
3.  **Связанные привычки** могут быть только типа "приятная".
4.  **Приятные привычки** не могут иметь **вознаграждение** или **связанную привычку**.
5.  **Периодичность** должна быть ≥ 1 раза в 7 дней (то есть, минимум раз в неделю).

### Пагинация:

*   Вывод списка привычек осуществляется по 5 элементов на страницу.

### Права доступа:

*   **CRUD операции** (Создание, Чтение, Обновление, Удаление) доступны только для собственных привычек пользователя.
*   **Просмотр публичных привычек** доступен всем пользователям без возможности редактирования.

## Интеграции:

*   **Telegram-бот:** Для отправки напоминаний о выполнении привычек.
*   **Celery:** Для обработки отложенных задач (например, отправка напоминаний, обработка периодических проверок).
*   **CORS:** Для обеспечения возможности взаимодействия фронтенда с API.
*   **Автодокументация API:** Генерация документации (например, с использованием Swagger/OpenAPI).

## Технологический Стек:

*   **Backend:** Python (Django REST Framework)
*   **База данных:** PostgreSQL (предпочтительно)
*   **Кэширование:** Redis
*   **Очередь задач:** Celery с Redis/RabbitMQ
*   **Управление зависимостями:** Poetry
*   **API документирование:** drf-yasg (Swagger/OpenAPI)

## Тестирование:

В данном проекте уделяется особое внимание качеству кода и надежности функционала. **Покрытие тестами составляет более 80%**. Это достигается за счет использования комплексных юнит- и интеграционных тестов, охватывающих:

*   **Модели данных:** Проверка корректности создания, валидации и сохранения объектов привычек, пользователей и других сущностей.
*   **API эндпоинты:** Тестирование всех CRUD операций, авторизации, пагинации, обработки ошибок и прав доступа.
*   **Бизнес-логику:** Проверка корректной работы логики, связанной с типами привычек, валидационными правилами и взаимодействием между компонентами.
*   **Celery задачи:** Тестирование отправки уведомлений и других фоновых процессов.

Использование тестов гарантирует, что новые изменения не нарушают существующий функционал и обеспечивают стабильную работу приложения.

## Установка и Запуск:

Данный проект использует Poetry для управления зависимостями.

1.  Клонируйте репозиторий:
    ```bash
    git clone git@github.com:Ekaterina353/habit.git
    cd habit
    ```
2.  Создайте и активируйте виртуальное окружение:
    ```bash
    python -m venv venv
    source venv/bin/activate  # Для Linux/macOS
    # venv\Scripts\activate  # Для Windows
    ```
3.  Установите зависимости с помощью Poetry:
    ```bash
    poetry install
    ```
    *(Примечание: Poetry также позаботится о создании `requirements.txt` при необходимости.)*
4.  Настройте переменные окружения. Рекомендуется использовать файл `.env` и установить переменную `DJANGO_SETTINGS_MODULE` в соответствии с вашим файловым путем.
5.  Примените миграции базы данных:
    ```bash
    poetry run python manage.py migrate
    ```
6.  Запустите сервер разработки Django:
    ```bash
    poetry run python manage.py runserver
    ```
7.  Для работы напоминаний и отложенных задач, запустите Celery worker:
    ```bash
    # Убедитесь, что Redis или RabbitMQ запущены
    poetry run celery -A drf_atomic_habits.celery worker -l info
    ```
8.  Для запуска всех тестов:
    ```bash
    poetry run python manage.py test
    ```
    *(Или более специфично, например: `poetry run pytest` если используется pytest)*

# Django
SECRET_KEY=your_secure_secret_key_here
DEBUG=True
ALLOWED_HOSTS=127.0.0.1,localhost,nginx

# База данных
DB_NAME=habitflow_db
DB_USER=postgres
DB_PASSWORD=your_strong_password
DB_HOST=db
DB_PORT=5432

# Redis & Celery
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0

# Telegram
TELEGRAM_BOT_TOKEN=your_telegram_bot_token

# Порты
DJANGO_PORT=8000
DJANGO_HOST=0.0.0.0
NGINX_PORT=80
NGINX_HOST=0.0.0.0

# Запуск проекта с использованием Docker Compose

Этот файл `docker-compose.yml` определяет конфигурацию для запуска всех необходимых сервисов вашего проекта: веб-приложения Django, базы данных PostgreSQL, Redis и Celery (worker и beat).

Докер
docker-compose

4. Запустите проект одной команды.
docker-compose up -d --build

5. Примените изменения и создайте суперпользователя.

docker-compose run backend python manage.py migrate --noinput
docker-compose run backend python manage.py createsuperuser

## Предварительные требования

*   [Docker](https://docs.docker.com/get-docker/) установлен и работает.
*   [Docker Compose](https://docs.docker.com/compose/install/) установлен (обычно входит в состав Docker Desktop).
*   Файл `.env` с необходимыми переменными окружения (например, `DATABASE_NAME`, `DATABASE_USER`, `DATABASE_PASSWORD`).

6. Открыть приложение
API: http://localhost
Админка: http://localhost/admin
Swagger: http://localhost/swagger
Redoc: http://localhost/redoc
🛠️ CI/CD: Действия GitHub
Проект настроен на автоматический CI/CD через GitHub Actions.

Что делает пайплайн:
✅ Проверяет код черезflake8
✅ Запускает тесты с PostgreSQL и Redis
✅ Собирает Docker-образы ( , )backendcelery
✅ успех Прие — деплоит на удаленный сервер через SSH
Настройка Действия GitHub
Перейдите вSettings → Secrets and variables → Actions
добавьте следующие секреты:
SSH_PRIVATE_KEY
Приватный ключ для доступа к серверу
SERVER_IP
IP-адрес сервера
SSH_USERNAME
Имя пользователя на расстоянии (например, )
ubuntu
SSH_PORT
Порт SSH (обычно )
22
SECRET_KEY
Секретный ключ Джанго
DB_PASSWORD
Пароль от PostgreSQL
TELEGRAM_BOT_TOKEN
Токен Telegram-бота
DEBUG
false
(для продакшена)

Файл пайплайна:.github/result/deploy.yml

🖥️ Настройка удаленного сервера
1. Установите Docker и Docker Compose.

sudo apt update && sudo apt upgrade -y
sudo apt install docker.io docker-compose -y
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker $USER
Перейдите по SSH. 

2. Настройте SSH-доступ для GitHub Actions.
Создадим SSH-ключ на локальной машине:
ssh-keygen -t ed25519 -C "github-actions@deploy" -f ./deploy_key
Содержимое ключей в телефоне.deploy_key.pub~/.ssh/authorized_keys
Приватный ключевой раздел в GitHub Secrets как .deploy_keySSH_PRIVATE_KEY
3. Убедитесь, что порты открыты.
22— SSH
80— HTTP (Nginx)
5432— PostgreSQL (опционально, если нужен доступ)
6379— Redis (опционально)
🚀 Автоматический деплой
При каждом коммите на ветку :work/final-work_9

Действия GitHub:
Проверяет код
Собирает образы
Развернуть на сервере
На сервере:
Клонируется репозиторий (если нужно)
Обновляется.env
Перезадача контейнеров
При смене прибытия
Собирается статика
🧪 Тесты
Запустите локальные тесты:

docker-compose run backend python manage.py test
Или через Docker:

python manage.py test --settings=config.settings.test

## Разработчик:

*   **Git:** Ekaterina353
*   **Проект:** habits
